"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const constants_1 = require("next/dist/next-server/lib/constants");
const path_1 = require("path");
const defaultConfig = `const withSass = require('@zeit/next-sass');
const withLess = require('@zeit/next-less');
const withStylus = require('@zeit/next-stylus');
const withCSS = require('@zeit/next-css');

/*
 * This file was generated by Nx 9.2.0 to allow greater control over configuration
 * for Next apps. To optimize your configuration please update the following export
 * with only the style plugin you are using.
 *
 * e.g. module.exports = withCSS({ cssModules: false });
 */
module.exports = withStylus(withLess(withSass(withCSS({
  // Set this to true if you use CSS modules.
  // See: https://github.com/css-modules/css-modules
  cssModules: false
}))));
`;
function update() {
    return schematics_1.chain([
        (host) => {
            const workspaceJson = workspace_1.readWorkspace(host);
            const nextProjects = Object.keys(workspaceJson.projects)
                .map((name) => {
                const p = workspaceJson.projects[name];
                const buildBuilder = p.architect && p.architect.build && p.architect.build.builder;
                return buildBuilder === '@nrwl/next:build' ? p : null;
            })
                .filter(Boolean);
            nextProjects.forEach((p) => {
                const configPath = path_1.join(p.root, constants_1.CONFIG_FILE);
                if (!host.exists(configPath)) {
                    host.create(configPath, defaultConfig);
                }
            });
        },
        workspace_1.formatFiles(),
    ]);
}
exports.default = update;
//# sourceMappingURL=create-next-config.js.map